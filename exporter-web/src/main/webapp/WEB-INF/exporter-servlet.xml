<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

  <!-- Spring MVC >=3.1 -->
  <bean class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping"/>
  <bean class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"/>
  <bean class="org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver"/>
  <bean class="org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolver"/>
  <bean class="org.springframework.web.servlet.mvc.annotation.ResponseStatusExceptionResolver"/>

  <!-- Generic utilities used throughout -->
  <bean id="baseUri" class="java.net.URI">
    <constructor-arg value="http://localhost:8080/data"/>
  </bean>
  <bean id="conversionService" class="org.springframework.core.convert.support.DefaultConversionService"/>

  <!-- Metadata for JPA Repositories -->
  <bean id="jpaRepositoryMetadata" class="org.springframework.data.services.repository.JpaRepositoryMetadata"/>
  <bean id="repositoryResolver" class="org.springframework.data.services.repository.JpaRepositoryResolver">
    <constructor-arg ref="baseUri"/>
    <constructor-arg>
      <list>
        <ref bean="jpaRepositoryMetadata"/>
      </list>
    </constructor-arg>
  </bean>
  <bean id="repositoryEntityResolver" class="org.springframework.data.services.repository.JpaRepositoryEntityResolver">
    <constructor-arg ref="baseUri"/>
    <constructor-arg ref="jpaRepositoryMetadata"/>
    <constructor-arg ref="conversionService"/>
  </bean>

  <!-- The Exporter -->
  <bean class="org.springframework.data.services.web.exporter.ResourceExporterController">
    <property name="baseUri" ref="baseUri"/>
    <property name="readResolvers">
      <list>
        <ref bean="repositoryResolver"/>
        <ref bean="repositoryEntityResolver"/>
        <bean class="org.springframework.data.services.web.exporter.QueryStringPropertyResolver">
          <constructor-arg value="p"/>
        </bean>
      </list>
    </property>
  </bean>

  <!-- Handle rendering in different representations -->
  <bean class="org.springframework.web.servlet.view.ContentNegotiatingViewResolver">
    <property name="defaultContentType" value="application/json"/>
    <property name="defaultViews">
      <list>
        <bean class="org.springframework.web.servlet.view.json.MappingJacksonJsonView"/>
      </list>
    </property>
  </bean>

</beans>